- content_for :title do @server.title end
.page-header
  .pull-right
    .btn-group 
      %button.btn.btn-primary.dropdown-toggle{"data-toggle" => 'dropdown'}
        Manage
        %span.caret
      %ul.dropdown-menu{role: "menu", id: "left-dropdown"}
        %li= link_to 'Edit', edit_server_path(@server)
        %li= link_to 'Delete', server_path(@server), method: :delete, data: {confirm: 'Are you sure you want to delete this server?'}
        %li= link_to 'Reports', server_reports_path(@server)
        %li= link_to 'Sponsor', new_server_path
  %h1= @server.title
.container
  .row
    .col-md-12
      .div.text-center
        .btn-group
          - if current_user and current_user.has_favored(@server)
            = link_to '<i class="fa fa-heart"></i> Unfavor'.html_safe, server_favorite_path(@server, current_user.favorite_for(@server)), class: 'btn btn-danger', method: :delete
          - else
            = link_to '<i class="fa fa-heart"></i> Favorite'.html_safe, new_server_favorite_path(@server), class: 'btn btn-danger'
          %a.btn.btn-success{href: server_vote_path(@server)}
            %i.fa.fa-thumbs-up
            Vote
          %a.btn.btn-danger{href: new_server_report_path(@server)}
            %i.fa.fa-flag
            Report
  .row
    .col-md-6
      %h2 Server Information
      %hr
      %table.table.table-bordered
        %tbody
          %tr
            %td 
              .glyphicon.glyphicon-upload
              IP Address
            %td
              %a{id: 'server-ip'}
                = @server.ip
              :javascript
                $('#server-ip').click(function() {
                  prompt("Copy to clipboard:", "#{@server.ip}")
                });
          %tr
            %td
              .glyphicon.glyphicon-download 
              Port
            %td= @server.port
          %tr
            %td 
              %i.fa.fa-history
              Version
            %td
              .label.label-primary= @server.version
          %tr
            %td 
              %i.fa.fa-list-ol
              Slots
            %td= @server.slots
          %tr
            %td 
              %i.fa.fa-exchange
              Sync
            %td
              - if @server.sync
                .label.label-success Enabled
              - else
                .label.label-danger Disabled
          %tr
            %td 
              %i.fa.fa-usd
              Gold
            %td
              - if @server.gold
                .label.label-warning Gold
              - else
                .label.label-danger Default
          %tr
            %td 
              %i.fa.fa-bars
              Difficulty
            %td
              - diff = @server.difficulty
              - if diff == "bambi"
                .label.label-success Bambi
              - elsif diff == "normal"
                .label.label-danger Normal
              - elsif diff == "hardcore"
                .label.label-danger Hardcore
          %tr
            %td 
              %i.fa.fa-compass
              Map
            %td
              .label.label-primary= @server.map
          %tr
            %td 
              %i.fa.fa-fighter-jet
              PvP
            %td
              - if @server.pvp
                .label.label-success Enabled
              - else
                .label.label-danger Disabled
          %tr
            %td 
              %i.fa.fa-user
              Owner
            %td= @server.user.username
          %tr
            %td 
              %i.fa.fa-calendar-o
              Registered
            %td
              .label.label-default= time_ago_in_words(@server.created_at) + ' ago'
          %tr
            %td
              %i.fa.fa-calendar
              Updated
            %td
              .label.label-default= time_ago_in_words(@server.updated_at) + ' ago'
    .col-md-6{id: "stats-col"}
      %h2 Statistics
      %hr
      %table.table.table-bordered
        %tbody
          %tr
            %td 
              %i.fa.fa-heart
              Favorites
            %td= @server.favorites.size
          %tr  
            %td 
              %i.fa.fa-thumbs-up
              Votes
            %td= @server.votes.size
          %tr
            %td 
              %i.fa.fa-eye
              Views
            %td 0
      .text-center
        %h3 Voting History
        %canvas{id: 'vote-chart', height: "350"}
        - today = Time.now
        :javascript
          var width = $("#stats-col").width();
          var canvas = document.getElementById("vote-chart");
          var ctx = canvas.getContext("2d");
          ctx.canvas.width = width;
          var data = {
              labels: ["#{(today - 6.day).strftime("%A")}", "#{(today - 5.day).strftime("%A")}", "#{(today - 4.day).strftime("%A")}", "#{(today - 3.day).strftime("%A")}", "#{(today - 2.day).strftime("%A")}", "#{(today - 1.day).strftime("%A")}", "#{today.strftime("%A")}"],
              datasets: [
                  {
                      label: "Vote Data",
                      fillColor: "rgba(151,187,205,0.2)",
                      strokeColor: "rgba(151,187,205,1)",
                      pointColor: "rgba(151,187,205,1)",
                      pointStrokeColor: "#fff",
                      pointHighlightFill: "#fff",
                      pointHighlightStroke: "rgba(151,187,205,1)",
                      data: [#{get_time(@server, 6)}, #{get_time(@server, 5)}, #{get_time(@server, 4)}, #{get_time(@server, 3)}, #{get_time(@server, 2)}, #{get_time(@server, 1)}, #{get_time(@server, 0)}]
                  }
              ]
          };
          var chart = new Chart(ctx).Line(data);
          chart.update();
  .row
    .col-md-6
      
    .col-md-6
      %h2 
        Share
        %small 
          Promote Your Server
      %hr
      %span.st_reddit_large{displaytext: "Reddit"}
      %span.st__large{displaytext: ""}
      %span.st_twitter_large{displaytext: "Tweet"}
      %span.st_googleplus_large{displaytext: "Google +"}
      %span.st_facebook_large{displaytext: "Facebook"}
      %span.st_email_large{displaytext: "Email"}

  .row
    .col-md-12
      %h2 Description
      %hr
      = simple_format(@server.info)
  .row
    .col-md-12
      %h2 
        Comments
        .pull-right
          .btn.btn-primary{id: 'click-btn'} Add Comment
      %hr
      - if current_user
        %div{id: 'show-form', show: false}
          = render 'comments/form'
        :javascript
          $("#show-form").toggle("show"); 
          $("#click-btn").click(function() {
            if ($("#show-form").is(":visible")) {
              $("#click-btn").text("Add Comment")
            } else {
              $("#click-btn").text("Hide")
            } 
            $("#show-form").toggle("show"); 
          }); 
      = render 'comments/view'


.text-center
  .btn-group{style: 'margin-top: 10px;'}
    %button.btn.btn-danger{type: "button"} Report

%script{type: "text/javascript"}var switchTo5x=true;
%script{type: "text/javascript", src: "http://w.sharethis.com/button/buttons.js"}
%script{type:"text/javascript"} stLight.options({publisher: "c2e6e60e-c42d-4a9b-a6c5-0ca8e2f39a96", doNotHash: false, doNotCopy: false, hashAddressBar: true});